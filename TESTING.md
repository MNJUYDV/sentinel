# Testing Guide for RAG MVP

## Quick Start Testing

### Step 1: Install Dependencies (if not already installed)

```bash
# If using a virtual environment (recommended)
pip install -r requirements.txt

# Or if dependencies are already installed, skip this step
```

### Step 2: Start the Server

```bash
uvicorn app:app --reload
```

You should see output like:
```
INFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
INFO:     Started reloader process
INFO:     Started server process
INFO:     Waiting for application startup.
INFO:     Loading embedding model: all-MiniLM-L6-v2
INFO:     RAG system initialized with 10 documents
INFO:     Application startup complete.
```

### Step 3: Test the Endpoints

#### Option A: Use Swagger UI (Easiest)

1. Open your browser and go to: http://localhost:8000/docs
2. You'll see an interactive API documentation
3. Click on `/health` → "Try it out" → "Execute" to test health check
4. Click on `/docs` → "Try it out" → "Execute" to see loaded documents
5. Click on `/answer` → "Try it out" → Enter a query and execute

#### Option B: Use curl Commands

Open a **new terminal** (keep the server running) and run these commands:

**1. Health Check:**
```bash
curl http://localhost:8000/health
```

Expected response:
```json
{"status":"healthy","service":"rag-mvp"}
```

**2. List Loaded Documents:**
```bash
curl http://localhost:8000/docs
```

Expected response: List of 10 documents with their IDs, titles, and timestamps.

**3. Test Query - Conflicting Policies:**
```bash
curl -X POST "http://localhost:8000/answer" \
  -H "Content-Type: application/json" \
  -d '{
    "query": "Can we store SSNs in plaintext?",
    "top_k": 5
  }'
```

**4. Test Query - Current API Rate Limit:**
```bash
curl -X POST "http://localhost:8000/answer" \
  -H "Content-Type: application/json" \
  -d '{
    "query": "What is the current API rate limit?",
    "top_k": 5
  }'
```

**5. Test Query - Refund Policy:**
```bash
curl -X POST "http://localhost:8000/answer" \
  -H "Content-Type: application/json" \
  -d '{
    "query": "Are refunds allowed for promotional purchases?",
    "top_k": 5
  }'
```

**6. Test Query - Data Retention:**
```bash
curl -X POST "http://localhost:8000/answer" \
  -H "Content-Type: application/json" \
  -d '{
    "query": "How long do we retain deleted messages?",
    "top_k": 5
  }'
```

## Expected Behavior

### With OpenAI API Key (in .env file):
- You'll get intelligent answers generated by GPT-3.5-turbo
- Answers will be based on retrieved chunks
- The response includes both the answer and the retrieved chunks with similarity scores

### Without OpenAI API Key:
- The system will use a stub answer generator
- Answers will echo the top retrieved chunks
- You'll see a note indicating it's using stub mode

## Testing Different Scenarios

### Test 1: Conflicting Information
The system should retrieve both:
- Current policy: "SSNs must not be stored in plaintext"
- Legacy policy: "SSNs may be stored in plaintext in restricted internal systems"

### Test 2: Stale vs Current Info
Query: "What is the current API rate limit?"
Should retrieve both 2021 (1000 req/hr) and 2024 (300 req/hr) docs.

### Test 3: Exception Handling
Query: "Are refunds allowed for promotional purchases?"
Should retrieve both the general refund policy and the exception.

## Troubleshooting

**Issue**: "Module not found" errors
- **Solution**: Run `pip install -r requirements.txt`

**Issue**: Server won't start
- **Solution**: Make sure port 8000 is not in use: `lsof -ti:8000 | xargs kill -9`

**Issue**: "Documents not loaded" error
- **Solution**: Check that `data/docs.json` exists and is valid JSON

**Issue**: OpenAI API errors
- **Solution**: Check your `.env` file has `OPENAI_API_KEY=sk-...` (it will fall back to stub mode if invalid)

## Python Script Testing

You can also test programmatically:

```python
import requests

# Test health
response = requests.get("http://localhost:8000/health")
print(response.json())

# Test query
response = requests.post(
    "http://localhost:8000/answer",
    json={"query": "Can we store SSNs in plaintext?", "top_k": 5}
)
print(response.json())
```

